# UnityPatcher
**UnityPatcher**, или же **Patcher**, — это консольная программа для замены Unity ассетов. Она базируется на библиотеке UnityPy.

![image](https://github.com/user-attachments/assets/a0dbf7f9-e270-4f0b-93c9-4e4e9f6a9c15)

### **Особенности**:
- Поддержка операций для таких типов как `Texture2D`, `TextAsset`, `AudioClip`, `VideoClip`, `MonoBehaviour`, и другие.  
- Поддержка экспорта дампов `MonoBehaviour` до Unity примерно 2021 версии (на основе AssetStudio).  
- Модифицирование бандлов напрямую без необходимости распаковки CAB-архивов.  
- Запаковка бандлов со сжатием, которое было в оригинале.  
- Экспорт ассетов на выбор в одном из форматов: **конвертация**, **raw**, или **JSON дамп**.  
- Функция импорта сперва пакует дамп, а затем связанный с ним конвертированный файл, что дает вам возможность импорта в связке, например, изображения и её дампа. 

### **Самое главное**:
Всё делается в несколько кликов, а команды очень простые. Также при импорте не учитывается структура папок, то есть нет жестко заданного пути где патч файлы должны лежать, а значит вы можете группировать патч файлы как вам захочется.

### **Требования**
- .NET Framework — для генерации typetree и сжатия текстур.
- ffmpeg, загруженный и добавленный в переменные среды PATH — для перекодирования видео (но это не обязательно, если вы не собираетесь использовать данную опцию).

### **Важная информация** 
- Вы должны паковать только отредактированные файлы.
- Patcher ориентирован на Unity игры, сделанные под **Windows**. Совместимость с другими платформами не гарантируется.
- В папке игры не должно быть файлов из разных игр или с одинаковыми
именами, иначе запаковка пройдет некорректно. Вы можете воспользоваться опцией `--blacklist` для добавления определенных папок и путей в черный список.
- Если возникают проблемы с загрузкой файлов во время патчинга ("Can't load file"), вы можете попробовать загрузить всю игровую папку целиком вместо использования частичной подгррузки `--load_all`.
- Если не импортируются определенные файлы, проверьте, не включен ли умный патчинг. Попробуйте отключить его и повторите снова. Проверьте, не включены ли фильтры по типу.
- Если у вас не очень мощный компьютер и вы испытываете низкую производительность при использовании программы, возможно у вас открыто много программ. Вы можете попробовать уменьшить количество потоков опцией `--threads` и посмотреть, улучшит ли это ситуацию.
- MonoBehaviour может потребовать дополнительных зависимостей, таких как globalgamemanagers. Если вы столкнулись с ошибкой "Failed to read typetree":
  1. Пролистайте лог выше и убедитесь в отсутствии строк "Typetree was not generated because Managed was not in the game folder". Если ваша игра не содержит папку Managed, воспользуйтесь [Il2CppDumper](https://github.com/Perfare/Il2CppDumper/releases) для генерации фиктивных библиотек при помощи файлов global-metadata.dat и GameAssembly.dll. Полученную папку переименуйте в Managed и поместить в Data папку вашей игры.
  2. Если вам не помог предыдущий шаг, возможно отсутствуют необходимые зависимости. Убедитесь, что в логе нет строк наподобие "Can't load dependency". Недостающие файлы надо поместить в папку игры. "Can't load possible dependency" — это просто предположительные зависимости, не факт, что они нужны на самом деле. 
- Patcher по-прежнему находится в разработке. Пожалуйста, если вы нашли баг, сообщите о нем [здесь](https://github.com/JunkBeat/UnityPatcher/issues). Но сперва убедитесь, всё ли вы сделали правильно (проверьте команду, файлы, и т.д.)!

### **Команды**
На данный момент UnityPatcher поддерживает 3 команды (запаковка, извлечение, поиск текста в ассетах). Полный список опций можно узнать, вызвав одну из следующих команд в консоли:
- `Patcher pack -h`
- `Patcher unpack -h`
- `Patcher search -h`

### **Примеры использования**
- `Patcher unpack --texture -c Text -i Game_Data -o ExtractedAssets`
- `Patcher pack Patches --outsamedir`
- `Patcher search "example text" --export`

### **Скачать**
[Последние релизы](https://github.com/JunkBeat/UnityPatcher/releases)

### **Поддержка**
Patcher — это соло-проект, а также попытка создать удобную моддинговую утилиту, доступную для всех. У меня уходит много времени на разработку, так что вы можете поддержать меня материально или отблагодарить за мою работу. В связи с затрудненность международных переводов вы можете купить для меня любой стим-ключ и отправить на почту pmwavex@gmail.com с указанием для какого он региона. Или Paypal, используя тот же почтовый адрес. Я буду вам очень благодарен!

### **TDoT и обратная связь**
Присоединяйтесь к [серверу TDoT](https://discord.gg/qEzKUq2SZ4), чтобы обсудить патчер, ознакомиться с подробным руководством по использованию, получать уведомления о новых версиях, и участвовать в совместном переводе игр вместе с нами!

*Примечание:* TDoT не связан с разработкой данной программы. Это просто команда переводчиков, в которой я состою.
